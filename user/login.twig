{% extends parent_template %}

{% block title %}{{ Lang.get('user.login') }}{% endblock %}

{% block breadcrumb %}
    {{ parent() }}
    {{ Lang.get('user.login') }}
{% endblock %}

{% block content %}

    {% if not Session.has('error') and Session.has('social_metadata') %}
        <div class="sp-alert sp-alert-info">
            {{ Lang.get('user.social_linking_login') }}
        </div>
    {% endif %}

    <div style="max-width: 28rem; margin: 0 auto;">
        <div style="background: rgba(31, 41, 55, 0.5); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 0.5rem; padding: 2rem;">
            <h2 style="font-size: 1.875rem; font-weight: 600; color: white; margin-bottom: 1.5rem; text-align: center; font-family: var(--font-playfair);">
                {{ Lang.get('user.login') }}
            </h2>

            {{ form_open({'route': 'user.login', 'method': 'post', 'class': 'validate'}) }}

                {% if intended_url is not null %}
                    {{ form_hidden('back', intended_url) }}
                {% endif %}

                <div class="sp-form-row">
                    {{ form_label('email', Lang.get('general.email')) }}
                    <div class="sp-input-container">
                        {{ form_email('email', null, {'autofocus': 'autofocus', 'style': 'width: 100%; padding: 0.75rem; background: rgba(31, 41, 55, 0.5); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 0.375rem; color: #f3f4f6;'}) }}
                    </div>
                </div>

                <div class="sp-form-row">
                    {{ form_label('password', Lang.get('general.password')) }}
                    <div class="sp-input-container">
                        {{ form_password('password', {'style': 'width: 100%; padding: 0.75rem; background: rgba(31, 41, 55, 0.5); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 0.375rem; color: #f3f4f6;'}) }}
                        <div style="margin-top: 0.5rem;">
                            <a href="{{ route('user.reset') }}" style="color: #a855f7; text-decoration: none; font-size: 0.875rem;">
                                {{ Lang.get('user.forgot_password') }}
                            </a>
                        </div>
                    </div>
                </div>

                <div class="sp-form-row">
                    <label></label>
                    <div class="sp-input-container">
                        <label style="display: flex; align-items: center; gap: 0.5rem; color: #d1d5db; cursor: pointer;">
                            {{ form_check('remember_me', '1', {'style': 'width: 1rem; height: 1rem; accent-color: #9333ea;'}) }}
                            <span>{{ Lang.get('user.remember_me') }}</span>
                        </label>
                    </div>
                </div>

                {% if showCaptcha %}
                    {% if Captcha.isVisible() %}
                        <div class="sp-form-row">
                            <div class="sp-input-container">
                                {{ Captcha.getHtml() }}
                            </div>
                        </div>
                    {% else %}
                        {{ Captcha.getHtml() }}
                    {% endif %}
                {% endif %}

                <div class="sp-form-row" style="margin-top: 1.5rem;">
                    <label></label>
                    <div class="sp-input-container">
                        {{ form_submit(Lang.get('user.login'), {'style': 'width: 100%; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #7e22ce 0%, #9333ea 50%, #a855f7 100%); color: white; border: none; border-radius: 0.5rem; font-weight: 500; font-size: 0.875rem; cursor: pointer;'}) }}
                    </div>
                </div>

                {% if not Request.has('social') %}
                    {% if SamlAuth.exists(SamlAuth.frontendGuard(current_brand(false))) or not socialite_providers.isEmpty() %}
                        <div style="margin: 1.5rem 0; text-align: center; position: relative;">
                            <div style="position: absolute; inset: 0; display: flex; align-items: center;">
                                <div style="flex: 1; height: 1px; background: rgba(168, 85, 247, 0.2);"></div>
                                <span style="padding: 0 1rem; color: #9ca3af; font-size: 0.875rem; background: rgba(31, 41, 55, 0.5);">{{ Lang.get('general.or') }}</span>
                                <div style="flex: 1; height: 1px; background: rgba(168, 85, 247, 0.2);"></div>
                            </div>
                        </div>

                        {% if SamlAuth.exists(SamlAuth.frontendGuard(current_brand(false))) %}
                            <div style="margin-bottom: 1rem;">
                                <input type="button" class="saml" value="{{ Lang.get('user.login_via', {'provider': Config.get('saml.guards.' ~ SamlAuth.frontendGuard(current_brand(false)) ~ '.idp.name', Lang.get('user.idp'))}) }}" 
                                       onclick="location.href='{{ route('frontend.saml_login', {'intended': intended_url is not null ? intended_url : ''}) }}';"
                                       style="width: 100%; padding: 0.75rem 1.5rem; background: rgba(31, 41, 55, 0.5); border: 1px solid rgba(168, 85, 247, 0.2); color: white; border-radius: 0.5rem; font-weight: 500; font-size: 0.875rem; cursor: pointer;" />
                            </div>
                        {% endif %}

                        {% if not socialite_providers.isEmpty() %}
                            {% include 'frontend.' ~ template ~ '.user.social_login_options' with {'new_line': true} %}
                        {% endif %}
                    {% endif %}

                    {% if Config.get('settings.registration_enabled') == 1 %}
                        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(168, 85, 247, 0.2); text-align: center;">
                            <p style="color: #9ca3af; font-size: 0.875rem; margin: 0;">
                                {{ Lang.get('user.dont_have_account') }}
                                <a href="{{ route('user.register') }}" style="color: #a855f7; text-decoration: none; font-weight: 500;">
                                    {{ Lang.get('user.register_now') }}
                                </a>
                            </p>
                        </div>
                    {% endif %}
                {% endif %}

            {{ form_close() }}
        </div>
    </div>

{% endblock %}

{% block scripts_footer %}
    {% if jsValidator|default is not empty %}
        {{ jsValidator|raw }}
    {% endif %}

    {% if showCaptcha %}
        {{ Captcha.getJs() }}
    {% endif %}
{% endblock %}
