<div class="sp-message sp-message-{{ message.id }} {% if message.by == 0 %}sp-message-staff{% endif %}" data-id="{{ message.id }}">
	<div class="sp-flex">
		<div class="sp-flex-initial sp-hidden sp-me-4 md:sp-block">
			<img src="{{ message.user.avatar_url }}" class="sp-avatar sp-max-w-xs md:sp-max-w-md" />
		</div>
		<div class="sp-grow">
			<div class="sp-message-header">
				<span class="sp-name sp-text-lg" style="color: white !important;">
					{{ message.user.formatted_name }}
				</span>
				{% if message.by == 0 %}
					<span class="sp-staff-badge" style="display: inline-block; margin-left: 0.25rem; padding: 0.125rem 0.5rem; background: rgba(168, 85, 247, 0.2); border: 1px solid rgba(168, 85, 247, 0.5); border-radius: 0.25rem; color: #a855f7; font-size: 0.75rem; font-weight: 500; vertical-align: middle;">
						{{ Lang.get('general.staff') }}
					</span>
				{% endif %}
				<div class="sp-description">{{ timeago(message.created_at) }}</div>
			</div>
		</div>
	</div>

	<div class="sp-message-text sp-flow-root">
		<div class="sp-message-text-original" dir="auto">
			{% if message.show_more is empty %}
				{{ message.purified_text|raw }}
			{% endif %}
		</div>
	</div>

	{% if not message.attachments.isEmpty() %}
		<ul class="sp-attachments">
			<hr class="sp-mx-0 sp-my-3 sp-border-secondary" />

			<div class="sp-flex">
				<div class="sp-grow">
					<h4 class="sp-m-0">{{ Lang.choice('general.attachment', 2) }}</h4>
				</div>
				<div class="sp-flex-initial">
					<button class="sp-download-all as-link" style="display: none;" title="{{ Lang.get('general.download_all') }}">
						<i class="fas fa-download sp-text-secondary hover:sp-text-primary"></i>
					</button>
				</div>
			</div>

			{% for attachment in message.attachments %}
				<li style="margin-bottom: 0.5rem;">
					{% if attachment.upload.isPreviewable() %}
						{% if attachment.upload.isPreviewableVideo() or attachment.upload.isPreviewableAudio() %}
							<a class="sp-attachment-preview"
							   data-video='{"source": [{"src":"{{ attachment.previewFrontendUrl(true) }}", "type":"{{ attachment.upload.mime }}"}], "attributes": {"preload": false, "controls": true}}'
					   		   data-download-url="{{ attachment.direct_frontend_url }}"
					   		   style="text-decoration: underline; color: #d1d5db;">
						{% else %}
							<a class="{% if attachment.upload.isPreviewableImage() %}sp-attachment-preview{% endif %}"
					   		   {% if not attachment.upload.isPreviewableImage() %}target="_blank"{% endif %}
					           href="{{ attachment.previewFrontendUrl(true) }}"
					           data-download-url="{{ attachment.direct_frontend_url }}"
					           style="text-decoration: underline; color: #d1d5db;">
						{% endif %}
					{% else %}
						<a href="{{ attachment.direct_frontend_url }}" style="text-decoration: underline; color: #d1d5db;">
					{% endif %}
						<span class="sp-filename">{{ attachment.original_name }}</span>
					</a>
					<span class="sp-description sp-filesize" style="color: #9ca3af; font-size: 0.875rem; margin-left: 0.5rem;">({{ attachment.upload.size }})</span>
					{% if message.by != 0 %}
						<span class="sp-remove-attachment-text" 
							  style="color: #ef4444; font-size: 0.875rem; margin-left: 0.5rem; cursor: pointer; text-decoration: underline;"
							  data-url="{{ route('ticket.frontend.attachment.destroy') }}"
							  data-token="{{ Request.input('token', '') }}"
							  data-attachment-id="{{ attachment.id }}"
							  data-hash="{{ attachment.upload_hash }}">(Remove)</span>
					{% endif %}
				</li>
			{% endfor %}
		</ul>
	{% endif %}
</div>
