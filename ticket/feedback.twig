{% extends parent_template %}

{% block title %}{{ Lang.get('ticket.feedback_for_ticket', {'number': ticket.number}) }}{% endblock %}

{% block breadcrumb %}
    {{ parent() }}
    <a href="{{ route('ticket.frontend.ticket.index') }}">{{ Lang.choice('ticket.ticket', 2) }}</a> &nbsp;&raquo;&nbsp;
    {{ Lang.choice('ticket.ticket', 1) }} #{{ ticket.number }}
{% endblock %}

{% block content %}

    <div style="max-width: 42rem; margin: 0 auto;">
        <div style="background: rgba(31, 41, 55, 0.5); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 0.5rem; padding: 2rem;">
            {% if saved %}
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="width: 6rem; height: 6rem; margin: 0 auto 1rem; background: rgba(34, 197, 94, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #22c55e;">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <h4 style="font-size: 1.5rem; font-weight: 600; color: white; margin: 0; font-family: var(--font-playfair);">
                        {{ Lang.get('ticket.feedback_saved') }}
                    </h4>
                </div>
                <div style="margin: 2rem 0; padding: 2rem 0; border-top: 1px solid rgba(168, 85, 247, 0.2); border-bottom: 1px solid rgba(168, 85, 247, 0.2);"></div>
            {% endif %}

            <h2 style="font-size: 1.875rem; font-weight: 600; color: white; margin-bottom: 1.5rem; font-family: var(--font-playfair);">
                {{ Lang.get('ticket.how_was_the_help') }}
            </h2>

            {{ form_open({'route': ['ticket.frontend.ticket.feedback', ticket.number, token]}) }}

                {{ form_hidden('rating', rating) }}

                <div class="sp-feedback" style="margin: 2rem 0;">
                    <div style="display: grid; grid-template-columns: repeat(1, minmax(0, 1fr)); gap: 1rem; sm:grid-template-columns: repeat(3, minmax(0, 1fr));">
                        <div class="sp-feedback-rating {% if rating == GOOD_RATING %}selected{% endif %}" data-rating="{{ GOOD_RATING }}" style="background: {% if rating == GOOD_RATING %}rgba(168, 85, 247, 0.2){% else %}rgba(31, 41, 55, 0.5){% endif %}; border: 2px solid {% if rating == GOOD_RATING %}#a855f7{% else %}rgba(168, 85, 247, 0.2){% endif %}; border-radius: 0.5rem; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s; hover:border-color: #a855f7; hover:transform: translateY(-2px);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #22c55e; margin: 0 auto 0.5rem;">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            <div style="color: white; font-weight: 500; margin-top: 0.5rem;">{{ Lang.get('ticket.good_satisfied') }}</div>
                        </div>
                        <div class="sp-feedback-rating {% if rating == NEUTRAL_RATING %}selected{% endif %}" data-rating="{{ NEUTRAL_RATING }}" style="background: {% if rating == NEUTRAL_RATING %}rgba(168, 85, 247, 0.2){% else %}rgba(31, 41, 55, 0.5){% endif %}; border: 2px solid {% if rating == NEUTRAL_RATING %}#a855f7{% else %}rgba(168, 85, 247, 0.2){% endif %}; border-radius: 0.5rem; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s; hover:border-color: #a855f7; hover:transform: translateY(-2px);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #fbbf24; margin: 0 auto 0.5rem;">
                                <line x1="5" x2="19" y1="12" y2="12"/>
                            </svg>
                            <div style="color: white; font-weight: 500; margin-top: 0.5rem;">{{ Lang.get('ticket.im_not_sure') }}</div>
                        </div>
                        <div class="sp-feedback-rating {% if rating == BAD_RATING %}selected{% endif %}" data-rating="{{ BAD_RATING }}" style="background: {% if rating == BAD_RATING %}rgba(168, 85, 247, 0.2){% else %}rgba(31, 41, 55, 0.5){% endif %}; border: 2px solid {% if rating == BAD_RATING %}#a855f7{% else %}rgba(168, 85, 247, 0.2){% endif %}; border-radius: 0.5rem; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s; hover:border-color: #a855f7; hover:transform: translateY(-2px);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #ef4444; margin: 0 auto 0.5rem;">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="m15 9-6 6"/>
                                <path d="m9 9 6 6"/>
                            </svg>
                            <div style="color: white; font-weight: 500; margin-top: 0.5rem;">{{ Lang.get('ticket.bad_not_satisfied') }}</div>
                        </div>
                    </div>
                </div>

                {% include 'frontend.' ~ template ~ '.forms.custom_fields' %}

                <div class="sp-form-row" style="margin-top: 1.5rem;">
                    <label></label>
                    <div class="sp-input-container">
                        {{ form_submit(Lang.get(saved ? 'ticket.update_feedback' : 'ticket.save_feedback'), {'style': 'width: 100%; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #7e22ce 0%, #9333ea 50%, #a855f7 100%); color: white; border: none; border-radius: 0.5rem; font-weight: 500; font-size: 0.875rem; cursor: pointer;'}) }}
                    </div>
                </div>

            {{ form_close() }}
        </div>
    </div>

{% endblock %}

{% block scripts_footer %}
    <!-- WYSIWYG Editor -->
    <script src="{{ asset_rev('resources/assets/libs/editor.min.js') }}"></script>

    <!-- Custom fields -->
    <script src="{{ asset_rev('resources/assets/general/js/customfields.js') }}"></script>

    <script>
        $(document).ready(function() {
            // Date picker
            $('.datepicker').datepicker();

            // Update the rating.
            $('.sp-feedback-rating').on('click', function () {
                $('.sp-feedback-rating').each(function() {
                    this.style.background = 'rgba(31, 41, 55, 0.5)';
                    this.style.borderColor = 'rgba(168, 85, 247, 0.2)';
                });
                $(this).css({
                    'background': 'rgba(168, 85, 247, 0.2)',
                    'border-color': '#a855f7'
                });

                $('form').find('input[name="rating"]').val($(this).data('rating'));
            });

            // Disable form button on click
            $('form').on('submit', function () {
                $(this).find("input[type='submit']").prop('disabled', true);
            });
        });
    </script>
{% endblock %}
