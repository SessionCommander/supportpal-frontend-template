<!DOCTYPE html>
<html class="{{ get_template_mode(false) }}" dir="{{ get_template_dir() }}" lang="{{ App.getLocale() }}">

<head>
    {{ View.fireHook('frontend.head_start') }}

    {% set title = block('title') is defined ? block('title') : Lang.get('general.support_portal')|e %}
    <title>{{ company }} - {{ title|raw }}</title>

    {% block meta %}{% endblock %}
    <meta property="og:title" content="{{ title|raw }}" />
    <meta property="og:image" content="{{ get_logo() }}" />

    {% include 'frontend.' ~ template ~ '.head_common' %}

    {% block scripts_header %}{% endblock %}

    {% set route = Route.currentRouteName() %}

    {{ View.fireHook('frontend.head') }}
    {{ View.fireHook('frontend.head_end') }}
</head>

<body class="sp-bg-secondary sp-text-primary print:sp-bg-primary">

    {{ View.fireHook('frontend.body_start') }}

    <!-- Header - Exact match to website -->
    <header id="main-header">
        <div class="header-container">
            {{ View.fireHook('frontend.header_start') }}

            <div class="header-inner">
                <a href="https://sessioncommander.com" class="logo-link">
                    <img src="https://sessioncommander.com/logo.svg" alt="SessionCommander" />
                    <span class="logo-text">SessionCommander</span>
                </a>

                <!-- Desktop Navigation -->
                <div class="nav-desktop">
                    <a href="https://sessioncommander.com/features" class="nav-link">Features</a>
                    <a href="https://sessioncommander.com/pricing" class="nav-link">Pricing</a>
                    <a href="https://sessioncommander.com/about" class="nav-link">About</a>
                    <a href="https://support.sessioncommander.com" class="nav-link">Support</a>
                    <a href="https://community.sessioncommander.com" class="nav-link">Community</a>
                    {% if auth_check() %}
                        <div class="sp-dropdown-container sp-relative" style="margin-left: 0.5rem;">
                            <a class="sp-action" style="color: #d1d5db; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                                <img class="sp-avatar" src="{{ auth_user().avatar_url }}" style="width: 32px; height: 32px; border-radius: 50%;" />
                                {{ auth_user().formatted_name }}
                                <i class="fas fa-chevron-down" style="margin-left: 0.25rem; font-size: 0.75rem;" aria-hidden="true"></i>
                            </a>
                            <div class="sp-dropdown sp-end-0 sp-mt-2">
                                {% include 'frontend.' ~ template ~ '.navigation' with {'account': true} %}
                            </div>
                        </div>
                    {% else %}
                        <a href="https://app.sessioncommander.com" class="btn-login">Log In</a>
                    {% endif %}
                </div>

                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn" id="mobile-menu-toggle" aria-label="Toggle menu">
                    <svg viewBox="0 0 24 24" style="width: 24px; height: 24px;">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" fill="currentColor"></path>
                    </svg>
                </button>
            </div>

            {% block header %}{% endblock %}

            {{ View.fireHook('frontend.header_end') }}
        </div>
    </header>

    <!-- Mobile Menu -->
    <nav id="mobile-menu">
        <div class="menu-content">
            <a href="https://sessioncommander.com/features" class="mobile-nav-link">Features</a>
            <a href="https://sessioncommander.com/pricing" class="mobile-nav-link">Pricing</a>
            <a href="https://sessioncommander.com/about" class="mobile-nav-link">About</a>
            <a href="https://support.sessioncommander.com" class="mobile-nav-link">Support</a>
            <a href="https://community.sessioncommander.com" class="mobile-nav-link">Community</a>
            <div class="mobile-nav-divider">
                {% if auth_check() %}
                    <a href="{{ route('user.login') }}" class="mobile-btn-login">{{ Lang.get('user.login') }}</a>
                {% else %}
                    <a href="https://app.sessioncommander.com" class="mobile-btn-login">Log In</a>
                {% endif %}
            </div>
        </div>
    </nav>

    {% block precontent %}{% endblock %}

    <!-- Main Content -->
    <main>
        <div class="content-wrapper">
            {{ View.fireHook('frontend.wrapper_start') }}

            {% block page_header %}
            {% set has_breadcrumb = block('breadcrumb') is not empty %}
            {% set has_page_title = block('page_title') is defined and block('page_title') is not empty %}
            {% if has_breadcrumb or has_page_title %}
            <div class="page-header">
                <div class="page-header-content">
                    {% if has_breadcrumb %}
                    <div class="page-header-breadcrumb">
                        <a href="{{ route('core.frontend.home') }}">{{ Lang.get('general.support_portal') }}</a>
                        {% block breadcrumb %}{% endblock %}
                    </div>
                    {% endif %}
                    {% if has_page_title %}
                    <h1 class="page-header-title">
                        {% block page_title %}{% endblock %}
                    </h1>
                    {% endif %}
                    {% block page_description %}{% endblock %}
                </div>
            </div>
            {% endif %}
            {% endblock %}

            <div style="display: flex; flex-wrap: wrap-reverse; gap: 2rem;">
                <div style="flex: 1; min-width: 0;">
                    {{ View.fireHook('frontend.content_start') }}

                    <div class="sp-content-inner">
                        {{ View.fireHook('frontend.content_inner_start') }}

                        {% block subtitle %}{% endblock %}

                        <!-- Box to display success/error messages generated by JavaScript -->
                        <div class="sp-alert sp-hidden" id="js-message-box" style="display: none !important;"></div>

                        {% if Session.has('success') %}
                            <div class="sp-alert sp-alert-success">{{ Session.get('success')|raw }}</div>
                        {% elseif Session.has('error') %}
                            <div class="sp-alert sp-alert-error">{{ Session.get('error')|raw }}</div>
                        {% elseif Session.has('warning') %}
                            <div class="sp-alert sp-alert-warning">{{ Session.get('warning')|raw }}</div>
                        {% endif %}

                        {% if errors|default is not empty and errors.count() %}
                            <div class="sp-alert sp-alert-error">
                                <strong>{{ Lang.get('messages.please_correct') }}</strong><br />
                                {% for error in errors.all() %}
                                    {{ error }}<br />
                                {% endfor %}
                            </div>
                        {% endif %}

                        {% block content %}{% endblock %}

                        {{ View.fireHook('frontend.content_inner_end') }}
                    </div>

                    {{ View.fireHook('frontend.content_end') }}
                </div>

                {% block sidebar %}{% endblock %}

                {{ View.fireHook('frontend.wrapper_end') }}
            </div>
        </div>
    </main>

    <!-- Footer - Exact match to website -->
    <footer>
        <div class="footer-container">
            <div class="footer-grid">
                <!-- Brand -->
                <div class="footer-brand">
                    <a href="https://sessioncommander.com" class="footer-logo-link">
                        <img src="https://sessioncommander.com/logo.svg" alt="SessionCommander" />
                        <span class="footer-logo-text">SessionCommander</span>
                    </a>
                    <p class="footer-description">
                        Recording session management designed exclusively for classical music professionals.
                    </p>
                </div>

                <!-- Quick Links -->
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li>
                            <a href="https://sessioncommander.com/features">Features</a>
                        </li>
                        <li>
                            <a href="https://sessioncommander.com/pricing">Pricing</a>
                        </li>
                        <li>
                            <a href="https://sessioncommander.com/about">About</a>
                        </li>
                    </ul>
                </div>

                <!-- Resources -->
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li>
                            <a href="https://support.sessioncommander.com">Support</a>
                        </li>
                        <li>
                            <a href="https://community.sessioncommander.com">Community Forum</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p class="footer-copyright">
                    &copy; {{ "now"|date("Y") }} SessionCommander. All rights reserved.
                </p>
                <div class="footer-links">
                    <a href="https://sessioncommander.com/privacy">Privacy Policy</a>
                    <a href="https://sessioncommander.com/terms">Terms of Service</a>
                    <a href="https://sessioncommander.com/terms-summary">Terms Summary</a>
                    <a href="https://sessioncommander.com/sla">SLA</a>
                    <a href="https://sessioncommander.com/dpa">DPA</a>
                    {% if Config.get('settings.language_frontend_toggle') == 1 %}
                        <div style="display: inline-flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-language" title="{{ Lang.choice('general.language', 1) }}" style="color: #6b7280;"></i>
                            <select name="language" style="background-color: #1f2937; color: #d1d5db; border: 1px solid #374151; border-radius: 0.375rem; padding: 0.25rem 0.5rem; font-size: 0.875rem;">
                                {% for code, language in languages %}
                                    <option value="{{ code }}"
                                            {% if code == App.getLocale() %}selected="selected"{% endif %}
                                            {% if attribute(returnTo, code) is defined %}data-return-to="{{ attribute(returnTo, code) }}"{% endif %}>
                                        {{ language }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </footer>

    {{ View.fireHook('frontend.footer') }}

    {% include 'frontend.' ~ template ~ '.footer_common' %}

    <script src="{{ asset_rev('resources/assets/frontend/js/main.js')}}"></script>

    <script>
        // Header scroll effect - exact match to website
        (function() {
            const header = document.getElementById('main-header');
            if (header) {
                let scrolled = false;
                const handleScroll = () => {
                    const isScrolled = window.scrollY > 20;
                    if (isScrolled !== scrolled) {
                        scrolled = isScrolled;
                        if (scrolled) {
                            header.classList.add('scrolled');
                        } else {
                            header.classList.remove('scrolled');
                        }
                    }
                };
                window.addEventListener('scroll', handleScroll);
                handleScroll(); // Check initial state
            }
        })();

        // Mobile menu toggle
        (function() {
            const toggle = document.getElementById('mobile-menu-toggle');
            const menu = document.getElementById('mobile-menu');
            if (toggle && menu) {
                toggle.addEventListener('click', () => {
                    menu.classList.toggle('open');
                });
            }
        })();
    </script>

    {% block scripts_footer %}{% endblock %}

    <script>
        // Hide SupportPal branding that might be injected
        (function() {
            function hideSupportPalBranding() {
                // Hide any elements containing SupportPal text
                const allElements = document.querySelectorAll('*');
                allElements.forEach(function(el) {
                    const text = el.textContent || '';
                    if (text.includes('Self-Hosted Help Desk Software by SupportPal') || 
                        (text.includes('SupportPal') && text.trim().length < 100 && 
                         !el.closest('header') && !el.closest('script') && !el.closest('style'))) {
                        el.style.display = 'none';
                        el.style.visibility = 'hidden';
                    }
                });
                
                // Also hide by class/id patterns
                document.querySelectorAll('[class*="supportpal"], [id*="supportpal"], [class*="SupportPal"], [id*="SupportPal"]').forEach(function(el) {
                    el.style.display = 'none';
                    el.style.visibility = 'hidden';
                });
            }
            
            // Run on load and after delays for dynamic content
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', hideSupportPalBranding);
            } else {
                hideSupportPalBranding();
            }
            setTimeout(hideSupportPalBranding, 500);
            setTimeout(hideSupportPalBranding, 1000);
            setTimeout(hideSupportPalBranding, 2000);
            
            // Watch for new elements
            const observer = new MutationObserver(function(mutations) {
                let shouldCheck = false;
                mutations.forEach(function(mutation) {
                    if (mutation.addedNodes.length > 0) {
                        shouldCheck = true;
                    }
                });
                if (shouldCheck) {
                    setTimeout(hideSupportPalBranding, 100);
                }
            });
            observer.observe(document.body, { childList: true, subtree: true });
        })();
    </script>

    {{ View.fireHook('frontend.body_end') }}

</body>

</html>
