<!DOCTYPE html>
<html class="{{ get_template_mode(false) }}" dir="{{ get_template_dir() }}" lang="{{ App.getLocale() }}">

<head>
    {{ View.fireHook('frontend.head_start') }}

    {% set title = block('title') is defined ? block('title') : Lang.get('general.support_portal')|e %}
    <title>{{ company }} - {{ title|raw }}</title>

    {% block meta %}{% endblock %}
    <meta property="og:title" content="{{ title|raw }}" />
    <meta property="og:image" content="{{ get_logo() }}" />

    {% include 'frontend.' ~ template ~ '.head_common' %}

    {% block scripts_header %}{% endblock %}

    {% set route = Route.currentRouteName() %}

    {{ View.fireHook('frontend.head') }}
    {{ View.fireHook('frontend.head_end') }}
</head>

<body class="sp-bg-secondary sp-text-primary print:sp-bg-primary">

    {{ View.fireHook('frontend.body_start') }}

    <!-- Header - Exact match to website -->
    <header id="main-header">
        <div class="header-container">
            {{ View.fireHook('frontend.header_start') }}

            <div class="header-inner">
                <a href="{{ route('core.frontend.home') }}" class="logo-link">
                    {% if Config.get('settings.favicon') is not empty %}
                        <img src="{{ Config.get('settings.favicon') }}" alt="{{ company }}" />
                    {% else %}
                        <img src="{{ get_logo(false) }}" alt="{{ company }}" class="sp-inline dark:sp-hidden print:sp-inline" />
                        <img src="{{ get_logo(true) }}" alt="{{ company }}" class="sp-hidden dark:sp-inline print:sp-hidden" />
                    {% endif %}
                    <span class="logo-text">SessionCommander</span>
                </a>

                <!-- Desktop Navigation -->
                <div class="nav-desktop">
                    {% if Config.get('settings.website_url') is not empty %}
                        <a href="{{ Config.get('settings.website_url') }}/features" class="nav-link">Features</a>
                        <a href="{{ Config.get('settings.website_url') }}/pricing" class="nav-link">Pricing</a>
                        <a href="{{ Config.get('settings.website_url') }}/about" class="nav-link">About</a>
                        <div class="nav-divider"></div>
                        <a href="{{ route('core.frontend.home') }}" class="nav-resource">Support</a>
                        <a href="{{ Config.get('settings.website_url') }}/community" class="nav-resource">Community</a>
                    {% endif %}

                    {% if auth_check() %}
                        <div class="sp-dropdown-container sp-relative" style="margin-left: 0.5rem;">
                            <a class="sp-action" style="color: #d1d5db; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                                <img class="sp-avatar" src="{{ auth_user().avatar_url }}" style="width: 32px; height: 32px; border-radius: 50%;" />
                                {{ auth_user().formatted_name }}
                                <i class="fas fa-chevron-down" style="margin-left: 0.25rem; font-size: 0.75rem;" aria-hidden="true"></i>
                            </a>
                            <div class="sp-dropdown sp-end-0 sp-mt-2">
                                {% include 'frontend.' ~ template ~ '.navigation' with {'account': true} %}
                            </div>
                        </div>
                    {% else %}
                        <a href="{{ route('user.login') }}" class="btn-login">Log In</a>
                    {% endif %}
                </div>

                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn" id="mobile-menu-toggle" aria-label="Toggle menu">
                    <svg viewBox="0 0 24 24" style="width: 24px; height: 24px;">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" fill="currentColor"></path>
                    </svg>
                </button>
            </div>

            {% block header %}{% endblock %}

            {{ View.fireHook('frontend.header_end') }}
        </div>
    </header>

    <!-- Mobile Menu -->
    <nav id="mobile-menu">
        <div class="menu-content">
            {% if Config.get('settings.website_url') is not empty %}
                <a href="{{ Config.get('settings.website_url') }}/features" class="mobile-nav-link">Features</a>
                <a href="{{ Config.get('settings.website_url') }}/pricing" class="mobile-nav-link">Pricing</a>
                <a href="{{ Config.get('settings.website_url') }}/about" class="mobile-nav-link">About</a>
                <div class="mobile-nav-divider">
                    <a href="{{ route('core.frontend.home') }}" class="mobile-nav-resource">Support</a>
                    <a href="{{ Config.get('settings.website_url') }}/community" class="mobile-nav-resource">Community</a>
                    {% if auth_check() %}
                        <a href="{{ route('user.login') }}" class="mobile-btn-login">{{ Lang.get('user.login') }}</a>
                    {% else %}
                        <a href="{{ route('user.login') }}" class="mobile-btn-login">Log In</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </nav>

    {% block precontent %}{% endblock %}

    <!-- Main Content -->
    <main>
        <div class="content-wrapper">
            {{ View.fireHook('frontend.wrapper_start') }}

            <div style="margin-bottom: 2rem;">
                <h1 style="display: none;">
                    {% block title %}{{ Lang.get('general.support_portal') }}{% endblock %}
                </h1>
                <div class="sp-breadcrumb">
                    <a href="{{ route('core.frontend.home') }}">{{ Lang.get('general.support_portal') }}</a> &nbsp;&raquo;&nbsp;
                    {% block breadcrumb %}{% endblock %}
                </div>
            </div>

            <div style="display: flex; flex-wrap: wrap-reverse; gap: 2rem;">
                <div style="flex: 1; min-width: 0;">
                    {{ View.fireHook('frontend.content_start') }}

                    <div class="sp-content-inner">
                        {{ View.fireHook('frontend.content_inner_start') }}

                        {% block subtitle %}{% endblock %}

                        <!-- Box to display success/error messages generated by JavaScript -->
                        <div class="sp-alert sp-hidden" id="js-message-box"></div>

                        {% if Session.has('success') %}
                            <div class="sp-alert sp-alert-success">{{ Session.get('success')|raw }}</div>
                        {% elseif Session.has('error') %}
                            <div class="sp-alert sp-alert-error">{{ Session.get('error')|raw }}</div>
                        {% elseif Session.has('warning') %}
                            <div class="sp-alert sp-alert-warning">{{ Session.get('warning')|raw }}</div>
                        {% endif %}

                        {% if errors|default is not empty and errors.count() %}
                            <div class="sp-alert sp-alert-error">
                                <strong>{{ Lang.get('messages.please_correct') }}</strong><br />
                                {% for error in errors.all() %}
                                    {{ error }}<br />
                                {% endfor %}
                            </div>
                        {% endif %}

                        {% block content %}{% endblock %}

                        {{ View.fireHook('frontend.content_inner_end') }}
                    </div>

                    {{ View.fireHook('frontend.content_end') }}
                </div>

                {% block sidebar %}{% endblock %}

                {{ View.fireHook('frontend.wrapper_end') }}
            </div>
        </div>
    </main>

    <!-- Footer - Exact match to website -->
    <footer>
        <div class="footer-container">
            <div class="footer-grid">
                <!-- Brand -->
                <div class="footer-brand">
                    <a href="{{ route('core.frontend.home') }}" class="footer-logo-link">
                        {% if Config.get('settings.favicon') is not empty %}
                            <img src="{{ Config.get('settings.favicon') }}" alt="{{ company }}" />
                        {% else %}
                            <img src="{{ get_logo(false) }}" alt="{{ company }}" class="sp-inline dark:sp-hidden" />
                            <img src="{{ get_logo(true) }}" alt="{{ company }}" class="sp-hidden dark:sp-inline" />
                        {% endif %}
                        <span class="footer-logo-text">SessionCommander</span>
                    </a>
                    <p class="footer-description">
                        Recording session management designed exclusively for classical music professionals.
                    </p>
                </div>

                <!-- Quick Links -->
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        {% if Config.get('settings.website_url') is not empty %}
                            <li>
                                <a href="{{ Config.get('settings.website_url') }}/features">Features</a>
                            </li>
                            <li>
                                <a href="{{ Config.get('settings.website_url') }}/pricing">Pricing</a>
                            </li>
                            <li>
                                <a href="{{ Config.get('settings.website_url') }}/about">About</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>

                <!-- Resources -->
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li>
                            <a href="{{ route('core.frontend.home') }}">Support</a>
                        </li>
                        {% if Config.get('settings.website_url') is not empty %}
                            <li>
                                <a href="{{ Config.get('settings.website_url') }}/community">Community Forum</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p class="footer-copyright">
                    &copy; {{ "now"|date("Y") }} SessionCommander. All rights reserved.
                </p>
                <div class="footer-links">
                    {% if Config.get('settings.website_url') is not empty %}
                        <a href="{{ Config.get('settings.website_url') }}/privacy">Privacy Policy</a>
                        <a href="{{ Config.get('settings.website_url') }}/terms">Terms of Service</a>
                        <a href="{{ Config.get('settings.website_url') }}/terms-summary">Terms Summary</a>
                        <a href="{{ Config.get('settings.website_url') }}/sla">SLA</a>
                        <a href="{{ Config.get('settings.website_url') }}/dpa">DPA</a>
                    {% endif %}
                    {% if Config.get('settings.language_frontend_toggle') == 1 %}
                        <div style="display: inline-flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-language" title="{{ Lang.choice('general.language', 1) }}" style="color: #6b7280;"></i>
                            <select name="language" style="background-color: #1f2937; color: #d1d5db; border: 1px solid #374151; border-radius: 0.375rem; padding: 0.25rem 0.5rem; font-size: 0.875rem;">
                                {% for code, language in languages %}
                                    <option value="{{ code }}"
                                            {% if code == App.getLocale() %}selected="selected"{% endif %}
                                            {% if attribute(returnTo, code) is defined %}data-return-to="{{ attribute(returnTo, code) }}"{% endif %}>
                                        {{ language }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </footer>

    {{ View.fireHook('frontend.footer') }}

    {% include 'frontend.' ~ template ~ '.footer_common' %}

    <script src="{{ asset_rev('resources/assets/frontend/js/main.js')}}"></script>

    <script>
        // Header scroll effect - exact match to website
        (function() {
            const header = document.getElementById('main-header');
            if (header) {
                let scrolled = false;
                const handleScroll = () => {
                    const isScrolled = window.scrollY > 20;
                    if (isScrolled !== scrolled) {
                        scrolled = isScrolled;
                        if (scrolled) {
                            header.classList.add('scrolled');
                        } else {
                            header.classList.remove('scrolled');
                        }
                    }
                };
                window.addEventListener('scroll', handleScroll);
                handleScroll(); // Check initial state
            }
        })();

        // Mobile menu toggle
        (function() {
            const toggle = document.getElementById('mobile-menu-toggle');
            const menu = document.getElementById('mobile-menu');
            if (toggle && menu) {
                toggle.addEventListener('click', () => {
                    menu.classList.toggle('open');
                });
            }
        })();
    </script>

    {% block scripts_footer %}{% endblock %}

    {{ View.fireHook('frontend.body_end') }}

</body>

</html>
